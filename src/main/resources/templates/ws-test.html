<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WebSocket JWT í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸</title>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h2>WebSocket JWT í…ŒìŠ¤íŠ¸</h2>
<label
>WebSocket URL:
  <input
      type="text"
      id="ws-url"
      value="http://localhost:8080/ws"
      size="50" /></label
><br />
<label>JWT: <input type="text" id="jwt" size="80" /></label><br />
<label
>Subscribe ì£¼ì†Œ:
  <input type="text" id="sub-dest" value="/server/test" size="50" /></label
><br />
<label
>Send ì£¼ì†Œ:
  <input type="text" id="send-dest" value="/client/test" size="50" /></label
><br />
<label
>ë³´ë‚¼ ë©”ì‹œì§€:
  <input type="text" id="message" value="í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€" size="50" /></label
><br />
<button onclick="connect()">ì—°ê²°</button>
<button onclick="sendMessage()">ë©”ì‹œì§€ ë³´ë‚´ê¸°</button>
<pre id="output"></pre>

<script>
  let socket = new SockJS("http://localhost:8080/ws");
  let stompClient = Stomp.over(socket);

  function log(msg) {
    document.getElementById("output").textContent += msg + "\n";
  }

  function connect() {
    const url = document.getElementById("ws-url").value;
    const jwt = document.getElementById("jwt").value;
    const socket = new SockJS(url);
    stompClient = Stomp.over(socket);

    stompClient.connect(
        { Authorization: "Bearer " + jwt },
        (frame) => {
          log("[âœ… ì—°ê²° ì„±ê³µ] " + frame);
          const subDest = document.getElementById("sub-dest").value;
          stompClient.subscribe(subDest, (msg) => {
            log("[ğŸ“© ìˆ˜ì‹ ] " + msg.body);
          });
        },
        (error) => {
          log("[âŒ ì—°ê²° ì‹¤íŒ¨] " + error);
        }
    );
  }

  function sendMessage() {
    const dest = document.getElementById("send-dest").value;
    const message = document.getElementById("message").value;
    if (stompClient && stompClient.connected) {
      stompClient.send(dest, {}, JSON.stringify({ message }));
      log("[ğŸ“¤ ì „ì†¡] " + message);
    } else {
      log("[âš ï¸ ì˜¤ë¥˜] WebSocketì´ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
    }
  }
</script>
</body>
</html>
